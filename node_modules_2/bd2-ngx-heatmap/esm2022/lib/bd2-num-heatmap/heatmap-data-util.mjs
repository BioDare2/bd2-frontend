import { BoxDef, BoxSerie } from '../bd2-heatmap.dom';
export class HeatmapDataUtil {
    seriesToBoxes(series, asymmetric = false) {
        return series.map(s => this.serieToBoxes(s, asymmetric));
    }
    serieToBoxes(org, asymmetric = false) {
        const cpy = Object.assign(new BoxSerie(), org);
        cpy.data = asymmetric ? this.pointsToAsymBoxes(org.data) : this.pointsToSymBoxes(org.data);
        return cpy;
    }
    pointsToAsymBoxes(points, defMargin = 0.5) {
        if (!points || points.length === 0) {
            return [];
        }
        if (points.length === 1) {
            const point = points[0];
            return [new BoxDef(point.x, point.y, point.x - defMargin, point.x + defMargin)];
        }
        const boxes = [];
        const first = points[0];
        boxes.push(new BoxDef(first.x, first.y, (3 * first.x - points[1].x) / 2, (first.x + points[1].x) / 2));
        for (let i = 1; i < (points.length - 1); i++) {
            boxes.push(this.asymBoxFromPoints(points[i], points[i - 1], points[i + 1]));
        }
        const last = points[points.length - 1];
        boxes.push(new BoxDef(last.x, last.y, (points[points.length - 2].x + last.x) / 2, (3 * last.x - points[points.length - 2].x) / 2));
        return boxes;
    }
    asymBoxFromPoints(point, prev, next) {
        return new BoxDef(point.x, point.y, (prev.x + point.x) / 2, (point.x + next.x) / 2);
    }
    pointsToSymBoxes(points, defMargin = 0.5) {
        if (!points || points.length === 0) {
            return [];
        }
        if (points.length === 1) {
            const point = points[0];
            return [new BoxDef(point.x, point.y, point.x - defMargin, point.x + defMargin)];
        }
        const boxes = [];
        const first = points[0];
        boxes.push(new BoxDef(first.x, first.y, (3 * first.x - points[1].x) / 2, (first.x + points[1].x) / 2));
        for (let i = 1; i < (points.length - 1); i++) {
            boxes.push(this.symBoxFromPoints(points[i], points[i - 1], points[i + 1]));
        }
        const last = points[points.length - 1];
        boxes.push(new BoxDef(last.x, last.y, (points[points.length - 2].x + last.x) / 2, (3 * last.x - points[points.length - 2].x) / 2));
        return boxes;
    }
    symBoxFromPoints(point, prev, next) {
        const defL = point.x - prev.x;
        const defR = next.x - point.x;
        const def = Math.min(defL, defR) / 2;
        return new BoxDef(point.x, point.y, point.x - def, point.x + def);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhdG1hcC1kYXRhLXV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9iZDItbmd4LWhlYXRtYXAvc3JjL2xpYi9iZDItbnVtLWhlYXRtYXAvaGVhdG1hcC1kYXRhLXV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQWUsTUFBTSxvQkFBb0IsQ0FBQztBQUVsRSxNQUFNLE9BQU8sZUFBZTtJQUkxQixhQUFhLENBQUMsTUFBZSxFQUFFLFVBQVUsR0FBRyxLQUFLO1FBQy9DLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUVELFlBQVksQ0FBQyxHQUFVLEVBQUUsVUFBVSxHQUFHLEtBQUs7UUFFekMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLFFBQVEsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQy9DLEdBQUcsQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNGLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVELGlCQUFpQixDQUFDLE1BQWUsRUFBRSxTQUFTLEdBQUcsR0FBRztRQUNoRCxJQUFJLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQUUsT0FBTyxFQUFFLENBQUM7U0FBRTtRQUVsRCxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxD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QyxDQUFDLENBQUM7UUFDeEIsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV2RyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzVDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzVFO1FBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdkMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbkksT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsZ0JBQWdCLENBQUMsS0FBWSxFQUFFLElBQVcsRUFBRSxJQUFXO1FBQ3JELE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM5QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDcEUsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtCb3hEZWYsIEJveFNlcmllLCBQb2ludCwgU2VyaWV9IGZyb20gJy4uL2JkMi1oZWF0bWFwLmRvbSc7XHJcblxyXG5leHBvcnQgY2xhc3MgSGVhdG1hcERhdGFVdGlsIHtcclxuXHJcblxyXG5cclxuICBzZXJpZXNUb0JveGVzKHNlcmllczogU2VyaWVbXSwgYXN5bW1ldHJpYyA9IGZhbHNlKTogQm94U2VyaWVbXSB7XHJcbiAgICByZXR1cm4gc2VyaWVzLm1hcChzID0+IHRoaXMuc2VyaWVUb0JveGVzKHMsIGFzeW1tZXRyaWMpKTtcclxuICB9XHJcblxyXG4gIHNlcmllVG9Cb3hlcyhvcmc6IFNlcmllLCBhc3ltbWV0cmljID0gZmFsc2UpOiBCb3hTZXJpZSB7XHJcblxyXG4gICAgY29uc3QgY3B5ID0gT2JqZWN0LmFzc2lnbihuZXcgQm94U2VyaWUoKSwgb3JnKTtcclxuICAgIGNweS5kYXRhID0gYXN5bW1ldHJpYyA/IHRoaXMucG9pbnRzVG9Bc3ltQm94ZXMob3JnLmRhdGEpIDogdGhpcy5wb2ludHNUb1N5bUJveGVzKG9yZy5kYXRhKTtcclxuICAgIHJldHVybiBjcHk7XHJcbiAgfVxyXG5cclxuICBwb2ludHNUb0FzeW1Cb3hlcyhwb2ludHM6IFBvaW50W10sIGRlZk1hcmdpbiA9IDAuNSk6IEJveERlZltdIHtcclxuICAgIGlmICghcG9pbnRzIHx8IHBvaW50cy5sZW5ndGggPT09IDApIHsgcmV0dXJuIFtdOyB9XHJcblxyXG4gICAgaWYgKHBvaW50cy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgY29uc3QgcG9pbnQgPSBwb2ludHNbMF07XHJcbiAgICAgIHJldHVybiBbbmV3IEJveERlZihwb2ludC54LCBwb2ludC55LCBwb2ludC54IC0gZGVmTWFyZ2luLCBwb2ludC54ICsgZGVmTWFyZ2luKV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYm94ZXMgPSBbXTtcclxuICAgIGNvbnN0IGZpcnN0ID0gcG9pbnRzWzBdO1xyXG4gICAgYm94ZXMucHVzaChuZXcgQm94RGVmKGZpcnN0LngsIGZpcnN0LnksICgzICogZmlyc3QueCAtIHBvaW50c1sxXS54KSAvIDIsIChmaXJzdC54ICsgcG9pbnRzWzFdLngpIC8gMikpO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgKHBvaW50cy5sZW5ndGggLSAxKTsgaSsrKSB7XHJcbiAgICAgIGJveGVzLnB1c2godGhpcy5hc3ltQm94RnJvbVBvaW50cyhwb2ludHNbaV0sIHBvaW50c1tpIC0gMV0sIHBvaW50c1tpICsgMV0pKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsYXN0ID0gcG9pbnRzW3BvaW50cy5sZW5ndGggLSAxXTtcclxuICAgIGJveGVzLnB1c2gobmV3IEJveERlZihsYXN0LngsIGxhc3QueSwgKHBvaW50c1twb2ludHMubGVuZ3RoIC0gMl0ueCArIGxhc3QueCkgLyAyLCAoMyAqIGxhc3QueCAtIHBvaW50c1twb2ludHMubGVuZ3RoIC0gMl0ueCkgLyAyKSk7XHJcblxyXG4gICAgcmV0dXJuIGJveGVzO1xyXG4gIH1cclxuXHJcbiAgYXN5bUJveEZyb21Qb2ludHMocG9pbnQ6IFBvaW50LCBwcmV2OiBQb2ludCwgbmV4dDogUG9pbnQpIHtcclxuICAgIHJldHVybiBuZXcgQm94RGVmKHBvaW50LngsIHBvaW50LnksIChwcmV2LnggKyBwb2ludC54KSAvIDIsIChwb2ludC54ICsgbmV4dC54KSAvIDIpO1xyXG4gIH1cclxuXHJcbiAgcG9pbnRzVG9TeW1Cb3hlcyhwb2ludHM6IFBvaW50W10sIGRlZk1hcmdpbiA9IDAuNSk6IEJveERlZltdIHtcclxuICAgIGlmICghcG9pbnRzIHx8IHBvaW50cy5sZW5ndGggPT09IDApIHsgcmV0dXJuIFtdOyB9XHJcblxyXG4gICAgaWYgKHBvaW50cy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgY29uc3QgcG9pbnQgPSBwb2ludHNbMF07XHJcbiAgICAgIHJldHVybiBbbmV3IEJveERlZihwb2ludC54LCBwb2ludC55LCBwb2ludC54IC0gZGVmTWFyZ2luLCBwb2ludC54ICsgZGVmTWFyZ2luKV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYm94ZXMgPSBbXTtcclxuICAgIGNvbnN0IGZpcnN0ID0gcG9pbnRzWzBdO1xyXG4gICAgYm94ZXMucHVzaChuZXcgQm94RGVmKGZpcnN0LngsIGZpcnN0LnksICgzICogZmlyc3QueCAtIHBvaW50c1sxXS54KSAvIDIsIChmaXJzdC54ICsgcG9pbnRzWzFdLngpIC8gMikpO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgKHBvaW50cy5sZW5ndGggLSAxKTsgaSsrKSB7XHJcbiAgICAgIGJveGVzLnB1c2godGhpcy5zeW1Cb3hGcm9tUG9pbnRzKHBvaW50c1tpXSwgcG9pbnRzW2kgLSAxXSwgcG9pbnRzW2kgKyAxXSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxhc3QgPSBwb2ludHNbcG9pbnRzLmxlbmd0aCAtIDFdO1xyXG4gICAgYm94ZXMucHVzaChuZXcgQm94RGVmKGxhc3QueCwgbGFzdC55LCAocG9pbnRzW3BvaW50cy5sZW5ndGggLSAyXS54ICsgbGFzdC54KSAvIDIsICgzICogbGFzdC54IC0gcG9pbnRzW3BvaW50cy5sZW5ndGggLSAyXS54KSAvIDIpKTtcclxuXHJcbiAgICByZXR1cm4gYm94ZXM7XHJcbiAgfVxyXG5cclxuICBzeW1Cb3hGcm9tUG9pbnRzKHBvaW50OiBQb2ludCwgcHJldjogUG9pbnQsIG5leHQ6IFBvaW50KSB7XHJcbiAgICBjb25zdCBkZWZMID0gcG9pbnQueCAtIHByZXYueDtcclxuICAgIGNvbnN0IGRlZlIgPSBuZXh0LnggLSBwb2ludC54O1xyXG4gICAgY29uc3QgZGVmID0gTWF0aC5taW4oZGVmTCwgZGVmUikgLyAyO1xyXG4gICAgcmV0dXJuIG5ldyBCb3hEZWYocG9pbnQueCwgcG9pbnQueSwgcG9pbnQueCAtIGRlZiwgcG9pbnQueCArIGRlZik7XHJcbiAgfVxyXG59XHJcbiJdfQ==