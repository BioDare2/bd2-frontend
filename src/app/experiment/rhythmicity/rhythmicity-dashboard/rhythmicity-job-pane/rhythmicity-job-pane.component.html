<div *ngIf="rhythmicityJobDatasource.allJob$ | async as job" class="panel panel-default">
  <div class="panel-heading clearfix">
    <div (click)="toggleExpanded()" role="button" class="pull-left">
                  <span [style.color]="isExpanded ? 'green' : 'red'" [style.font-size.%]="120"
                        class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
      &nbsp;{{shortUUID(job.jobId)}} ({{toLocalDateTime(job.jobStatus.submitted) | date}}) <br>
      {{job.parameters.METHOD}} {{job.parameters.PRESET}}
    </div>
    <div class="pull-right">
      {{job.jobStatus.state}}
      <a (click)="refresh()" role="button">
        <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
      </a>
    </div>

  </div>
  <div class="panel-body">
    <div class="clearfix">

      <div *ngIf="assay.security.canWrite" class="pull-right">
        <button type="button" class="btn btn-danger btn-sm" (click)="delete()">
          <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        <button type="button" class="btn btn-primary btn-sm" (click)="export()">
          <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
        </button>
      </div>

      {{job.parameters.PARAMS_SUMMARY}}
      <div *ngIf="job.jobStatus.message && job.jobStatus.message != 'OK'" class="text-danger" style="word-wrap: break-word;"><br>ERROR:
        {{job.jobStatus.message}}
      </div>
    </div>

    <div [hidden]="!isExpanded">

      <hr>
      <div *ngIf="rhythmicityJobDatasource.isRunning$ | async; else finished" >
        <mat-spinner class="center-block"></mat-spinner>
        <div style="margin-top: 0.5em; text-align: center" >It may take up to 10 minutes to test for rhythmicity</div>
      </div>
      <ng-template #finished>
        <bd2-pvalue-form (pvalue$)="rhythmicityResultsDataSource.pvalue($event)">
        </bd2-pvalue-form>
        <hr>

        <bd2-rhythmicity-results-mdtable></bd2-rhythmicity-results-mdtable>
      </ng-template>

    </div>
  </div>
</div>
