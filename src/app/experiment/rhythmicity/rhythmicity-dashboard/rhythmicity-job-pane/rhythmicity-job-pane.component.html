<div *ngIf="rhythmicityJobDatasource.allJob$ | async as job" class="panel panel-default">
  <div class="panel-heading clearfix">
    <div (click)="toggleExpanded()" role="button" class="pull-left">
                  <span [style.color]="isExpanded ? 'green' : 'red'" [style.font-size.%]="120"
                        class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>
      &nbsp;{{shortUUID(job.jobId)}} ({{toLocalDateTime(job.jobStatus.submitted) | date}}) <br>
      {{job.parameters.METHOD}} {{job.parameters.PRESET}}
    </div>
    <div class="pull-right">
      {{job.jobStatus.state}}
      <a (click)="refresh()" role="button">
        <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
      </a>
    </div>

  </div>
  <div class="panel-body">
    <mat-card>
      <mat-card-content>

      <div class="clearfix">

      <div *ngIf="assay.security.canWrite" class="pull-right">
        <button type="button" class="btn btn-danger btn-sm" (click)="delete()">
          <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
        <button type="button" class="btn btn-primary btn-sm" (click)="export()">
          <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
        </button>
      </div>

      {{job.parameters.PARAMS_SUMMARY}}
      <div *ngIf="job.jobStatus.message && job.jobStatus.message != 'OK'" class="text-danger" style="word-wrap: break-word;"><br>ERROR:
        {{job.jobStatus.message}}
      </div>
    </div>
      </mat-card-content>
    </mat-card>

    <div *ngIf="isExpanded">
      <mat-divider></mat-divider>
      <mat-card>
        <mat-card-content>
          <div *ngIf="rhythmicityJobDatasource.isReloading$ | async">
            <mat-spinner class="center-block"></mat-spinner>
            <!--<div style="margin-top: 0.5em; text-align: center" >It may take up to 10 minutes to test for rhythmicity</div>-->
          </div>
          <div *ngIf="job.jobStatus.state === 'SUBMITTED'">
            <div style="margin-top: 0.5em; text-align: center" >It may take up to 10 minutes to test for rhythmicity</div>
          </div>

          <ng-container *ngIf="rhythmicityJobDatasource.finishedJob$ | async as finishedJob">

            <bd2-stat-test-options-widget (options)="statTestOptions($event)">
            </bd2-stat-test-options-widget>


            <bd2-rhythmicity-results-mdtable
            [statTestParams]="statTestParams"
            [job]="finishedJob"></bd2-rhythmicity-results-mdtable>
          </ng-container>
        </mat-card-content>
      </mat-card>

    </div>
  </div>
</div>
