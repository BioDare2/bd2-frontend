<form [formGroup]="mainForm" class="form-horizontal" role="form">

  <div formGroupName="displayParams">

    <div class="form-group" formGroupName="timeScale">
      <label class="col-sm-4">Data window</label>

      <label class="col-sm-1" for="windowStart">from:</label>
      <div class="col-sm-2">
        <input class="form-control" formControlName="timeStart" id="windowStart" min="0" required
               size="5"
               step="any"
               type="number"
        >
      </div>
      <label class="col-sm-1" for="windowEnd">to:</label>
      <div class="col-sm-2">
        <input class="form-control" formControlName="timeEnd" id="windowEnd" min="0" placeholder=""
               required
               size="5"
               step="any"
               type="number"
        >
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-4" for="detrending">Input Data <a (click)="dataHelp = !dataHelp"><span
        aria-hidden="true" class="glyphicon glyphicon-question-sign"></span></a></label>

      <div class="col-sm-6">
        <select class="form-control" formControlName="detrending"
                id="detrending"
                required
        >
          <option *ngFor="let opt of detrendingOptions; let ix = index" [value]="opt.name">{{opt.label}}</option>
        </select>

      </div>

    </div>
  </div>
  <div  *ngIf="dataHelp" class="col-sm-12">
    <alert type="info">
      Rhythmicity tests are generally used for short, sparse timeseries. <br>
      The current limit is 5 or 4 days of hourly sampled data for eJTK preset and BD2 preset respectivelly.<br>
      Generally the raw data are being analysed, but we also enabled a linear detrended option.
    </alert>
  </div>


  <div class="form-group">
    <label class="col-sm-4" for="method">Test Method <a (click)="methodHelp = !methodHelp"><span
      aria-hidden="true" class="glyphicon glyphicon-question-sign"></span></a></label>

    <div class="col-sm-6">
      <select class="form-control" formControlName="method"
              id="method"
              required
      >
        <option *ngFor="let opt of methodOptions; let ix = index" [value]="opt.name">{{opt.label}}</option>
      </select>
    </div>
  </div>
  <div *ngIf="methodHelp"  class="col-sm-12">
    <alert type="info">
      BD2 eJTK is the BioDare2 implementation of Empirical JTK_CYCLE with asymmetry search
      from <a href=" https://doi.org/10.1371/journal.pcbi.1004094" target="_blank">Alan L. Hutchison et al. 2015</a>.
      It is a classic JTK method but with p values empirically calculated against set of random noise data.
    </alert>
  </div>


  <div class="form-group">
    <label class="col-sm-4" for="method">Analysis Presets <a (click)="presetsHelp = !presetsHelp"><span
      aria-hidden="true" class="glyphicon glyphicon-question-sign"></span></a></label>

    <div class="col-sm-6">
      <select class="form-control" formControlName="preset"
              id="preset"
              required
      >
        <option *ngFor="let opt of presetOptions; let ix = index" [value]="opt.name">{{opt.label}}</option>
      </select>
    </div>
  </div>
  <div *ngIf="presetsHelp" class="col-sm-12">
    <alert type="info">
      Presets determine set of pattern curves against the comparison test is run.<br>
      <ul>
      <li>eJTK Classic is recommended for typical omics-like data for which eJTK method was developed. <br>
        It works well for short data (48h, 2h- 1h-sampled) when actual period is within range 22-26 hours.<br>
        The patterns are series of cosine-like waveforms with 24h period, phases by 2hours
        and range of assymetries by 2h (see original paper).<br>
      </li>
      <li>BD2 Classic can detect non 24 periods and some forms of the spikes.<br>
      As it compares against much more patterns it has a weaker power, it should be used for long data (3 days or more)
      or if there is good reason to suspect periods outside 22-26h range.<br>
      The patterns are series of cosine-like waverforms with periods from 18-35hours, for each period there are mulitiple
        <b>circadian</b> phases with step 2h (so each period has same number of patterns) and range of assymetries by 2h
        in circadian units (see original paper). There are also additional some spike patterns.
      </li>
      </ul>
    </alert>
  </div>

  <div [hidden]="true" class="form-group" formGroupName="periodScale">
    <label class="col-sm-4">Expected periods</label>

    <label class="col-sm-1" for="periodMin">from:</label>
    <div class="col-sm-2">
      <input class="form-control" formControlName="periodMin" id="periodMin" max="50" min="10" placeholder=""
             required
             size="5"
             step="any"
             type="number"
      >
    </div>

    <label class="col-sm-1" for="periodMax">to:</label>
    <div class="col-sm-2">
      <input class="form-control" formControlName="periodMax" id="periodMax" max="50" min="10" placeholder=""
             required
             size="5"
             step="any"
             type="number"
      >
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-2"></label>
    <div class="col-sm-8">

      <mat-paginator #dataPaginator [length]="totalTraces" [disabled]="disabledPagination"
                     [pageSize]="currentPage.pageSize"
                     [pageIndex]="currentPage.pageIndex"
                     [pageSizeOptions]="[10, 25, 50, 100, 200]"
                     (page)="loadDataPage($event)"

      >
      </mat-paginator>
    </div>
  </div>

  <button (click)="analyse()" [disabled]="disabled || mainForm.invalid" class="btn btn-primary" type="button">Test Rhythmicity
  </button>

  <!--{{params | json }}-->
</form>

<bd2-static-pop-up #help></bd2-static-pop-up>
